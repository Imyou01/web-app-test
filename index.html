<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ứng dụng quản lý học viên</title>
  <link rel="stylesheet" href="styles.css" />

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-storage-compat.js"></script>
</head>
<body>
  <!-- AUTH Container -->
  <div id="auth-container">
    <!-- ... (giữ nguyên phần auth như cũ) ... -->
    <div id="login-form" class="auth-form active">
      <h2>Đăng nhập</h2>
      <input type="text" id="login-email" placeholder="Email hoặc tên đăng nhập" />
      <input type="password" id="login-password" placeholder="Mật khẩu" />
      <button onclick="login()">Đăng nhập</button>
      <p>
        <a href="#" onclick="showForm('register')">Đăng ký</a> | 
        <a href="#" onclick="showForm('forgot')">Quên mật khẩu?</a>
      </p>
    </div>

    <div id="register-form" class="auth-form">
      <h2>Đăng ký</h2>
      <input type="email" id="register-email" placeholder="Email" />
      <input type="text" id="register-name" placeholder="Họ và tên" />
      <input type="text" id="register-username" placeholder="Tên đăng nhập" />
      <input type="password" id="register-password" placeholder="Mật khẩu" />
      <button onclick="register()">Đăng ký</button>
      <p><a href="#" onclick="showForm('login')">Quay lại đăng nhập</a></p>
    </div>

    <div id="forgot-password-form" class="auth-form">
      <h2>Quên mật khẩu</h2>
      <input type="text" id="forgot-username" placeholder="Email hoặc tên đăng nhập" />
      <button onclick="forgotPassword()">Gửi yêu cầu</button>
      <p><a href="#" onclick="showForm('login')">Quay lại đăng nhập</a></p>
    </div>
  </div>

  <!-- DASHBOARD -->
  <div id="dashboard" style="display:none;">
    <nav id="main-nav" style="max-width:900px; margin:15px auto; padding:12px 20px; background:#f4f7ff; border-radius:12px; text-align:center; box-shadow:0 0 8px rgb(0 102 204 / 0.2);">
      <a href="#dashboard" class="active" style="margin:0 14px; font-weight:600; color:#004a99; text-decoration:none; padding:6px 10px; border-radius:6px;">Dashboard</a>
      <a href="#account-management" style="margin:0 14px; font-weight:600; color:#004a99; text-decoration:none; padding:6px 10px; border-radius:6px;">Quản lý tài khoản</a>
      <a href="#student-management" style="margin:0 14px; font-weight:600; color:#004a99; text-decoration:none; padding:6px 10px; border-radius:6px;">Quản lý học viên</a>
      <a href="#class-management" style="margin:0 14px; font-weight:600; color:#004a99; text-decoration:none; padding:6px 10px; border-radius:6px;">Quản lý lớp học</a>
      <a href="#profile-page" style="margin:0 14px; font-weight:600; color:#004a99; text-decoration:none; padding:6px 10px; border-radius:6px;">Trang cá nhân</a>
      <a href="#" onclick="logout(); return false;" style="margin:0 14px; font-weight:600; color:#cc0000;">Đăng xuất</a>
    </nav>

    <header style="max-width:900px; margin:10px auto 30px; padding:18px 24px; background:#0066cc; border-radius:12px; color:white; display:flex; align-items:center; gap:16px; cursor:pointer; box-shadow:0 2px 8px rgb(0 0 0 / 0.15);">
      <div class="avatar-container" onclick="openProfile()">
        <img id="avatar-img" src="https://via.placeholder.com/100" alt="Avatar" style="width:56px; height:56px; border-radius:50%; border:2.5px solid white; object-fit:cover;" />
        <span id="display-name" style="font-weight:700; font-size:20px;"></span>
        <p style="margin:0; font-size:15px; opacity:0.9;">Xin chào, <span id="display-name-hello"></span>!</p>
      </div>
    </header>

    <main class="grid-container" style="max-width:900px; margin:0 auto 50px; display:grid; grid-template-columns:repeat(auto-fill, minmax(240px, 1fr)); gap:24px; padding:0 10px;">
      <a class="card" href="#account-management" style="all:unset; cursor:pointer; display:flex; flex-direction:column; align-items:center; gap:12px; background:white; border-radius:18px; box-shadow:0 6px 12px rgb(0 0 0 / 0.1); padding:25px 20px; font-weight:700; font-size:17px; color:#004a99; text-align:center; text-decoration:none;">
        <div class="icon" style="font-size:42px; color:#0066cc;">&#9819;</div>
        <div>Quản lý tài khoản</div>
      </a>
      <a class="card" href="#student-management" style="all:unset; cursor:pointer; display:flex; flex-direction:column; align-items:center; gap:12px; background:white; border-radius:18px; box-shadow:0 6px 12px rgb(0 0 0 / 0.1); padding:25px 20px; font-weight:700; font-size:17px; color:#004a99; text-align:center; text-decoration:none;">
        <div class="icon" style="font-size:42px; color:#0066cc;">&#128214;</div>
        <div>Quản lý học viên</div>
      </a>
      <a class="card" href="#class-management" style="all:unset; cursor:pointer; display:flex; flex-direction:column; align-items:center; gap:12px; background:white; border-radius:18px; box-shadow:0 6px 12px rgb(0 0 0 / 0.1); padding:25px 20px; font-weight:700; font-size:17px; color:#004a99; text-align:center; text-decoration:none;">
        <div class="icon" style="font-size:42px; color:#0066cc;">&#127979;</div>
        <div>Quản lý lớp học</div>
      </a>
      <div class="card full-width" onclick="alert('Chức năng quản lý ngân sách đang phát triển')" style="aspect-ratio:auto; grid-column: span 2; max-width:none; background:white; border-radius:18px; box-shadow:0 6px 12px rgb(0 0 0 / 0.1); padding:25px 20px; font-weight:700; font-size:17px; color:#004a99; text-align:center; cursor:pointer; user-select:none;">
        <div class="icon" style="font-size:42px; color:#0066cc;">&#128176;</div>
        <div>Quản lý ngân sách</div>
      </div>
      <div class="card full-width" onclick="alert('Chức năng quản lý bài tập về nhà đang phát triển')" style="aspect-ratio:auto; grid-column: span 2; max-width:none; background:white; border-radius:18px; box-shadow:0 6px 12px rgb(0 0 0 / 0.1); padding:25px 20px; font-weight:700; font-size:17px; color:#004a99; text-align:center; cursor:pointer; user-select:none;">
        <div class="icon" style="font-size:42px; color:#0066cc;">&#128221;</div>
        <div>Quản lý bài tập về nhà</div>
      </div>
    </main>
  </div>

  <!-- Trang quản lý Lớp học -->
  <div id="class-management" class="management-page" style="display:none; max-width:900px; margin:40px auto 60px; background:#fff; padding:30px; border-radius:14px; box-shadow:0 0 18px rgb(0 0 0 / 0.12); font-size:16px; color:#222;">
    <h2>Quản lý lớp học</h2>
    <button onclick="showClassForm()" style="margin-bottom:15px;">Tạo lớp học mới</button>
    <table>
      <thead>
        <tr>
          <th>Tên lớp học</th>
          <th>Số lượng học viên</th>
          <th>Giáo viên đứng lớp</th>
          <th>Buổi đã học</th>
          <th>Lịch học cố định</th>
          <th>Hành động</th>
        </tr>
      </thead>
      <tbody id="class-list"></tbody>
    </table>
    <button onclick="backToDashboard()" style="margin-top:10px;">Quay lại Dashboard</button>

    <!-- Form tạo/sửa lớp học -->
    <div id="class-form-container" style="display:none; max-width:600px; margin-top:30px; background:#e6f0ff; padding:25px 25px 30px; border-radius:12px;">
      <h3 id="class-form-title" style="margin-top:0; font-weight:700; font-size:22px; color:#004a99;">Tạo lớp học mới</h3>
      <form id="class-form" onsubmit="event.preventDefault(); saveClass()">
        <input type="hidden" id="class-index" />
        <label>Tên lớp học:<br />
          <input type="text" id="class-name" required style="width:100%; padding:12px 14px; margin-top:10px; margin-bottom:20px; border-radius:8px; border:1px solid #aac0db; font-size:15px;" />
        </label><br />
        <label>Giáo viên đứng lớp:<br />
          <input type="text" id="class-teacher" required style="width:100%; padding:12px 14px; margin-top:10px; margin-bottom:20px; border-radius:8px; border:1px solid #aac0db; font-size:15px;" />
        </label><br />
        <fieldset style="border:1px solid #aac0db; border-radius:8px; padding:15px; margin-bottom:20px;">
          <legend style="font-weight:700; color:#004a99;">Chọn lịch học cố định</legend>
          <label><input type="checkbox" name="fixed-schedule" value="Monday" /> Thứ 2</label>
          <label><input type="checkbox" name="fixed-schedule" value="Tuesday" /> Thứ 3</label>
          <label><input type="checkbox" name="fixed-schedule" value="Wednesday" /> Thứ 4</label>
          <label><input type="checkbox" name="fixed-schedule" value="Thursday" /> Thứ 5</label>
          <label><input type="checkbox" name="fixed-schedule" value="Friday" /> Thứ 6</label>
          <label><input type="checkbox" name="fixed-schedule" value="Saturday" /> Thứ 7</label>
          <label><input type="checkbox" name="fixed-schedule" value="Sunday" /> Chủ nhật</label>
        </fieldset>
        <label>Thêm học viên:<br />
          <select id="class-add-student" style="width:100%; padding:12px 14px; margin-top:10px; margin-bottom:10px; border-radius:8px; border:1px solid #aac0db; font-size:15px;">
            <option value="">-- Chọn học viên --</option>
          </select>
          <button type="button" onclick="addStudentToClass()" style="margin-top:10px; padding:10px 20px; font-weight:700; background:#0066cc; color:#fff; border:none; border-radius:8px; cursor:pointer; transition:background-color 0.3s;">Thêm</button>
        </label><br />
        <label>Danh sách học viên trong lớp:</label>
        <ul id="class-student-list" style="list-style:none; padding-left:0; max-height:160px; overflow-y:auto; border:1px solid #aac0db; border-radius:8px; margin-top:10px; margin-bottom:20px;"></ul>
        <button type="submit" style="padding:12px 20px; font-weight:700; background:#0066cc; color:#fff; border:none; border-radius:8px; cursor:pointer; transition:background-color 0.3s;">Lưu</button>
        <button type="button" onclick="hideClassForm()" style="padding:12px 20px; font-weight:700; background:#d9534f; color:#fff; border:none; border-radius:8px; cursor:pointer; margin-left:10px; transition:background-color 0.3s;">Hủy</button>
      </form>
    </div>
  </div>

  <!-- Popup chi tiết lớp học -->
  <div id="class-detail-popup" style="display:none; position:fixed; top:10%; left:50%; transform:translateX(-50%); max-width:600px; background:#fff; padding:30px; border-radius:14px; box-shadow:0 0 24px rgba(0,0,0,0.25); z-index:10000;">
    <button onclick="closeClassDetail()" style="float:right; background:#e83a3a; border:none; border-radius:6px; color:#fff; font-weight:700; cursor:pointer; padding:6px 12px;">Đóng</button>
    <h2>Chi tiết lớp học</h2>
    <div id="class-detail-content" style="margin-top:20px; font-size:16px; color:#222;"></div>
  </div>

  <!-- Các phần khác (account, student, profile, auth...) giữ nguyên như trước -->

  <!-- Loading -->
  <div id="loading" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(255,255,255,0.85); text-align:center; padding-top:20%; z-index:9999;">
    <div class="spinner" style="border:5px solid #f3f3f3; border-top:5px solid #0066cc; border-radius:50%; width:50px; height:50px; animation:spin 1s linear infinite; margin:0 auto 10px auto;"></div>
    <p>Đang tải dữ liệu...</p>
  </div>

  <script src="script.js"></script>
</body>
</html>
